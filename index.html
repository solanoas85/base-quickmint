<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Base QuickMint</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
</head>
<body>
  <h1>Base QuickMint</h1>
  <button id="connectBtn">Connect Wallet</button>
  <button id="mintBtn" style="display:none">Mint NFT</button>
  <p id="status"></p>

  <script>
    const CONTRACT_ADDRESS = "0xB188cAf7D6906030d43a4f54aE5d5F34F64b7Bcd";
    const ABI = [
      "function mint() external",
      "function nextTokenId() view returns (uint256)"
    ];

    const BASE_SEPOLIA = {
      chainId: "0x14A34",
      chainName: "Base Sepolia",
      nativeCurrency: { name: "ETH", symbol: "ETH", decimals: 18 },
      rpcUrls: ["https://sepolia.base.org"],
      blockExplorerUrls: ["https://sepolia.basescan.org"]
    };

    let provider, signer, contract;

    async function ensureBaseSepolia() {
      const ethereum = window.ethereum;
      const chainId = await ethereum.request({ method: "eth_chainId" });
      if (chainId !== BASE_SEPOLIA.chainId) {
        try {
          await ethereum.request({
            method: "wallet_switchEthereumChain",
            params: [{ chainId: BASE_SEPOLIA.chainId }]
          });
        } catch (switchError) {
          if (switchError.code === 4902) {
            await ethereum.request({
              method: "wallet_addEthereumChain",
              params: [BASE_SEPOLIA]
            });
          } else {
            throw switchError;
          }
        }
      }
    }

    document.getElementById("connectBtn").onclick = async () => {
      if (!window.ethereum) return alert("Install MetaMask.");
      await window.ethereum.request({ method: "eth_requestAccounts" });
      await ensureBaseSepolia();
      provider = new ethers.providers.Web3Provider(window.ethereum);
      signer = provider.getSigner();
      contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);
      document.getElementById("status").innerText = "Wallet connected";
      document.getElementById("mintBtn").style.display = "inline-block";
    };

    document.getElementById("mintBtn").onclick = async () => {
      try {
        const tx = await contract.mint();
        document.getElementById("status").innerText = `Tx sent: ${tx.hash}`;
        await tx.wait();
        document.getElementById("status").innerText = "Mint complete!";
      } catch (err) {
        document.getElementById("status").innerText = `Error: ${err.message}`;
      }
    };
  </script>
</body>
</html>
